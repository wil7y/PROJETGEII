<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Page Admin - Gestion</title>
<link rel="stylesheet" href="styles.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
</head>
<header>
  <div class="logo-container">
    <img src="images/logo.png" alt="Logo Innov' CNC" class="logo" />
  </div>
  <div class="typewriter" data-text="Transformez vos idées :)"></div>
  <!-- Bouton burger -->
  <div class="burger-menu" id="burgerMenu">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
  <!-- Menu navigation -->
  <nav id="navLinks" class="nav-links">
    <a href="index.html">Accueil</a>
    <a href="boutique.html">Nos Services</a>
    <a href="contact.html">Contact</a>
    <a href="admin.html" >Admin</a>
    <a href="A propos.html" >A propos</a>
  </nav>

  <nav>
    <a href="index.html" class="nav-link">Accueil</a>
    <a href="boutique.html" class="nav-link">Nos Services</a>
    <a href="contact.html" class="nav-link">Contact</a>
    <a href="admin.html" class="nav-link">Admin</a>
    <a href="A propos.html" class="nav-link">A propos</a>
  </nav>
</header>
<body>

<h2>Connexion et gestion admin</h2>

<!-- Section connexion -->
<div id="authSection">
  <h3>Se connecter</h3>
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Mot de passe" />
  <button id="loginBtn">Se connecter</button>
</div>


<!-- Section dashboard (cachée par défaut) -->
<div id="dashboard" style="display:none;">
  <!-- Gestion produits -->
  <h1>Visiteurs du site : <span id="visitorCount">0</span></h1>
  <h3>Gestion des produits</h3><br>
  <form id="productAddForm">
    <input type="text" id="newTitle" placeholder="Titre" required /><br>
    <input type="text" id="newPrice" placeholder="Prix" required /><br>
    <input type="text" id="newImage" placeholder="URL Image" required /><br>
    <button type="submit">Ajouter un produit</button><br>
  </form>
  <table>
    <thead>
      <tr><th>Titre</th><th>Prix</th><th>Image</th><th>Actions</th></tr>
    </thead>
    <tbody id="productsTable"></tbody>
  </table><br>

  <!-- Gestion demandes -->
  <h3>Demandes de devis</h3>
  <table>
    <thead>
      <tr><th>Nom</th><th>Email</th><th>Message</th><th>Produit</th><th>Date</th><th>Actions</th></tr>
    </thead>
    <tbody id="requestsTable"></tbody>
  </table>
</div>
<script href="script.js"></script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<script>
   // Sélectionner éléments
const burger = document.getElementById('burgerMenu');
const navLinks = document.getElementById('navLinks');

burger.onclick = () => {
  navLinks.classList.toggle('open');
  // Animation du burger (optionnel)
  burger.classList.toggle('active');
};

// Fermer le menu si clic en dehors
document.addEventListener('click', (e) => {
  if (navLinks.classList.contains('open') && !navLinks.contains(e.target) && !burger.contains(e.target)) {
    navLinks.classList.remove('open');
    burger.classList.remove('active');
  }
});
  $(document).ready(function() {
  $('#yourTableId').DataTable();
});
  // CONFIGURATION Firebase - à remplir avec vos clés
  const firebaseConfig = {
    apiKey: "AIzaSyD32v3AgCCqiJd5sKIHQ3jxWl2ShZincYo",
    authDomain: "cncgeii.firebaseapp.com",
    projectId: "cncgeii",
    storageBucket: "cncgeii.firebasestorage.app",
    messagingSenderId: "607727685711",
    appId: "1:607727685711:web:e833379f71fc9433c61a3a",
    measurementId: "G-37ZX957ZYP"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Mot de passe admin prédéfini (pour login simple)
  const PASSWORD_ADMIN = "motdepasse";

  // Connexion
document.getElementById('loginBtn').onclick = () => {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById('authSection').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      loadAllManagement();
    })
    .catch(() => alert('Erreur de connexion'));
};

// Vérifie si déjà connecté
auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    loadAllManagement();
  } else {
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('dashboard').style.display = 'none';
  }
});

// Charger tout
function loadAllManagement() {
  loadProducts();
  loadRequests();
}

// Charger produits
function loadProducts() {
  firebase.firestore().collection('products').get()
  .then(snapshot => {
    const tbody = document.getElementById('productsTable');
    tbody.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const row = document.createElement('tr');
      row.innerHTML = `
        <td contenteditable="true" onblur="updateProduct('${doc.id}', 'title', this.innerText)">${data.title}</td>
        <td contenteditable="true" onblur="updateProduct('${doc.id}', 'price', this.innerText)">${data.price}</td>
        <td><img src="${data.image}" width="50" /></td>
        <td><button onclick="deleteProduct('${doc.id}')">Supprimer</button></td>
      `;
      tbody.appendChild(row);
    });
  });
}

// Ajouter produit
document.getElementById('productAddForm').onsubmit = (e) => {
  e.preventDefault();
  const title = document.getElementById('newTitle').value;
  const price = document.getElementById('newPrice').value;
  const image = document.getElementById('newImage').value;
  firebase.firestore().collection('products').add({ title, price, image })
  .then(() => {
    alert('Produit ajouté');
    document.getElementById('productAddForm').reset();
    loadProducts();
  });
};

// Supprimer produit
function deleteProduct(id) {
  if (confirm('Supprimer ce produit ?')) {
    firebase.firestore().collection('products').doc(id).delete().then(() => {
      alert('Produit supprimé');
      loadProducts();
    });
  }
}

// Modifier (inline)
function updateProduct(id, field, value) {
  firebase.firestore().collection('products').doc(id).update({ [field]: value });
}

// Charger demandes
function loadRequests() {
  firebase.firestore().collection('devis_requests').orderBy('date', 'desc').get()
  .then(snapshot => {
    const tbody = document.getElementById('requestsTable');
    tbody.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${data.name}</td>
        <td>${data.email}</td>
        <td>${data.message}</td>
        <td>${data.product}</td>
        <td>${data.date.toDate().toLocaleString()}</td>
        <td><button onclick="deleteRequest('${doc.id}')">Supprimer</button></td>
      `;
      tbody.appendChild(row);
    });
  });
}

// Supprimer demande
function deleteRequest(id) {
  if (confirm('Supprimer cette demande ?')) {
    firebase.firestore().collection('devis_requests').doc(id).delete().then(() => {
      alert('Demandes supprimée');
      loadRequests();
    });
  }
}

const dbRef = firebase.database().ref('visiteurs');

  dbRef.transaction(current => {
    return (current || 0) + 1;
  });

  dbRef.once('value').then(snapshot => {
    const count = snapshot.val();
    document.getElementById('visitorCount').innerText = count;
  });

</script>


</body>
</html>